## Description
RBT project for Georgi Ivanov

### Task

Create semi-distributed Wordpress installation on two instances in AWS and using DB from 3rd host.

### Solution
Solution is based on Terraform and Ansible, used for building AWS infrastructue and setting up DB host and Web servers respectively.

With terraform we:
1. Create a new VPC
1. Create 2 from each public (public access), application and DB subnets (private) in two availability zones.
1. Create respective Internet gateway and NAT gateway for private nets
1. Fix routing
1. Create security groups allowing only the minimal traffic between respective networks part of the security groups
1. Create IAM roles, profiles and attach respective policies.
1. Configure System Manager's Session manager in order to reach instances over SSM and not opening SSH public access to the instances.
1. Bring up ec2 instance for DB host based on latest Amazon Linux AMI (dynamically queried for) and attach EBS volume for storing DB data.
1. Create Launch template for automatically spinning new instances for Web servers.
1. Create Load balancer target group, listener and load balancer in the public net distributing the load between available Web servers.
1. Create autoscaling group to monitor after web servers availability and spin up new instances should any is unavailable/down


Ansible is used in both DB host and Launch template configuration user data to actually install and configure respective software.
Thanks to Stateful nature of terraform and declarativeness of Ansible, we achieve idempotency in actions.

There are no passwords stored in the repo. Whenever password is needed, it's automatically generated by Terraform on the fly and stored as SecureString in SSM Parameter store.  
Then during Ansible playbook execution, parameters are automatically obtained and applied. Sensitive data is obfuscated from Ansible logs.

For the sake of simplicity installation is only reachable via **http** and not *https*

Steps:

1. Make sure you have valid credentials for your AWS account in $HOME/.aws directory and/our your correct credentials are loaded
1. Clone current repo
1. cd to the `terraform` directory
1. run `terraform init`
2. run `terraform plan`. Validate the plan
2. run `terraform apply` and one prompted for confirmation type in `yes`
3. After successful completion, URL for accessing your Wordpress installation along with wpadmin credentials will be printed.

Due to the needed time for actual bootstrap process, service might need some time to start. During that time you may see `502 Bad Gateway` error. Try refreshing in couple of minutes.

Destroing everything including the built infra is as easy as:
`terraform destroy`

